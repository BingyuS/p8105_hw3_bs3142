p8105\_hw3\_bs3142
================
Bingyu Sun
10/7/2018

Problem 1
---------

#### Section 1: Data import

``` r
library(p8105.datasets)
data(brfss_smart2010)
```

#### Section 2: Data Manipulation

``` r
brfss_data =
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  select(-(class:question), -sample_size, -(confidence_limit_low:geo_location)) %>%
  mutate(response = factor(response))

str(brfss_data)
```

    ## Classes 'tbl_df', 'tbl' and 'data.frame':    10625 obs. of  5 variables:
    ##  $ year        : int  2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
    ##  $ locationabbr: chr  "AL" "AL" "AL" "AL" ...
    ##  $ locationdesc: chr  "AL - Jefferson County" "AL - Jefferson County" "AL - Jefferson County" "AL - Jefferson County" ...
    ##  $ response    : Factor w/ 5 levels "Excellent","Fair",..: 1 5 3 2 4 1 5 3 2 4 ...
    ##  $ data_value  : num  18.9 30 33.1 12.5 5.5 15.6 31.3 31.2 15.5 6.4 ...

#### Section 3: Q & A

**1. In 2002, which states were observed at 7 locations?**

``` r
brfss_data %>%
  filter(year == 2002) %>%
  group_by(locationabbr) %>%
  summarize(n_obs = n_distinct(locationdesc))
```

    ## # A tibble: 49 x 2
    ##    locationabbr n_obs
    ##    <chr>        <int>
    ##  1 AK               1
    ##  2 AL               1
    ##  3 AR               1
    ##  4 AZ               2
    ##  5 CA               1
    ##  6 CO               4
    ##  7 CT               7
    ##  8 DC               1
    ##  9 DE               3
    ## 10 FL               7
    ## # ... with 39 more rows

**CT, FL, NC** were observed at 7 locations.

**2. Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.**

``` r
brfss_data %>%
  group_by(year, locationabbr) %>%
  summarize(n_obs = n_distinct(locationdesc)) %>%
  ggplot(aes(x = year, y = n_obs, color = locationabbr)) + 
    geom_line() +
    labs(
      title = "Number of observations in each state 2002-2010",
      x = "Year",
      y = "Number of observations",
      caption = "Data from brfss_smart2010"
  ) +
  viridis::scale_color_viridis(
    name = "State", 
    discrete = TRUE
  )
```

<img src="p8105_hw3_bs3142_files/figure-markdown_github/unnamed-chunk-3-1.png" width="90%" />

**3. Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.**

``` r
brfss_data %>%
  filter(year %in% c("2002", "2006", "2010"), response == "Excellent", locationabbr == "NY") %>%
  spread(key = response, value = data_value) %>%
  group_by(year, locationdesc) %>%
  summarize(
    mean_prop_excellent_NY = mean(Excellent, na.rm = TRUE),
    sd_prop_excellent_NY = sd(Excellent, na.rm = TRUE)
  ) %>%
  spread(key = locationdesc, value = mean_prop_excellent_NY) %>% 
  knitr::kable(digits = 2)
```

|     year|  sd\_prop\_excellent\_NY|  NY - Bronx County|  NY - Erie County|  NY - Kings County|  NY - Monroe County|  NY - Nassau County|  NY - New York County|  NY - Queens County|  NY - Suffolk County|  NY - Westchester County|
|--------:|------------------------:|------------------:|-----------------:|------------------:|-------------------:|-------------------:|---------------------:|-------------------:|--------------------:|------------------------:|
|     2002|                       NA|                 NA|                NA|               19.5|                  NA|                26.9|                  27.9|                18.8|                 27.1|                       NA|
|     2006|                       NA|                 NA|                NA|               19.2|                  NA|                21.7|                  28.8|                18.9|                 20.6|                     26.0|
|     2010|                       NA|               17.6|              17.2|               22.4|                22.4|                26.2|                  25.8|                21.2|                 24.6|                     26.9|
|  ???????|       ???????? SD, table|                   |                  |                   |                    |                    |                      |                    |                     |                         |

**4. For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.**
